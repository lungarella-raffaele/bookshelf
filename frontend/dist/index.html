<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/css/tailwind.css" />
    </head>
    <body class="bg-bg">
        <div id="elm"></div>
        <script src="https://unpkg.com/lucide@latest"></script>
        <script src="/elm.js"></script>
        <script>
            const app = Elm.Main.init({
                node: document.getElementById("elm"),
            });

            customElements.define(
                "focus-trap-dialog",
                class extends HTMLElement {
                    connectedCallback() {
                        this.setupFocusTrap();
                    }

                    setupFocusTrap() {
                        const focusableElements = this.querySelectorAll(
                            'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',
                        );
                        const firstElement = focusableElements[0];
                        const lastElement =
                            focusableElements[focusableElements.length - 1];

                        this.addEventListener("keydown", (e) => {
                            if (e.key === "Tab") {
                                if (
                                    e.shiftKey &&
                                    document.activeElement === firstElement
                                ) {
                                    e.preventDefault();
                                    lastElement.focus();
                                } else if (
                                    !e.shiftKey &&
                                    document.activeElement === lastElement
                                ) {
                                    e.preventDefault();
                                    firstElement.focus();
                                }
                            }
                        });

                        firstElement?.focus();
                    }
                },
            );
            lucide.createIcons();
        </script>
    </body>
</html>
